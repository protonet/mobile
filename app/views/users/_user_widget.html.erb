<% users = SystemPreferences.show_only_online_users ? [] : User.registered.all -%>
<div id="user-widget" class="widget">
  <h3>
    <% if SystemPreferences.show_only_online_users -%>
      Online Users
    <% else -%>
      Users <output class="count">(0/<%= users.size %>)</output>
    <% end -%>
    <span class="loading-hint">loading ...</span>
  </h3>
  <ul>
    <!-- tabindex="-1" ensures that the element is focusable via css -->
    <% users.each do |user| -%>
      <li <%= raw 'class="myself"' if user.id == current_user.id %>>
        <a href="/users/<%= user.id %>" data-user-id="<%= user.id %>" data-user-avatar="<%= user.avatar.url %>" data-user-channel-subscriptions="<%= user.channels.map(&:id).to_json %>" title="<%= user.display_name %>"><%= user.display_name %></a>
      </li>
    <% end -%>
  </ul>
  <div class="resize"></div>
</div>