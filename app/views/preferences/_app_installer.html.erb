<h2>Apps</h2>
<p>Install third party apps on your node.</p>

<h3>Applications</h3>
<ul class="collapsable-list">
  <%- App.available_apps.sort_by(&:display_name).each do |app| -%>
    <li>
      <h4 class="headline" onclick="$('#details-app-<%= app.key %>').toggle()"><%= app.display_name %><%= " (installed)" if app.installed? -%></h4>
      <div class="details" id="details-app-<%= app.key %>" style="display:none">
        <%- unless app.description.blank? -%>
          <p><strong>Description:</strong> <%= app.description %></p>
        <%- end -%>
        <%- unless app.homepage.blank? -%>
          <p><strong>Homepage:</strong> <a href="<%= app.homepage %>" target="_blank"><%= app.homepage %></a></p>
        <%- end -%>
        <%- if app.installed? -%>
          <%= form_tag preferences_uninstall_app_path,{ :remote => true, 'data-type' => 'html', :class => "app-uninstall"} do -%>
              <%= hidden_field_tag 'app[key]', app.key %>
              <div class="form-field">
                <label for="app_configuration_password">Your node root password:</label>
                <%= password_field_tag "app[password]", '' %>
              </div>
              <button>uninstall</button>
          <%- end -%>
        <%- else -%>
          <%= form_tag preferences_install_app_path,{ :remote => true, 'data-type' => 'html', :class => "app-installation"} do -%>
            <%= hidden_field_tag 'app[key]', app.key %>
            <%- app.configuration_requirements.each_pair do |key, description| -%>
              <div class="form-field">
                <label for="app_configuration_<%= key %>"><%= description %></label>
                <%- if key.to_s.include?('password') -%>
                  <%= password_field_tag "app[configuration][#{key}]", '' %>
                <%- else -%>
                  <%= text_field_tag "app[configuration][#{key}]", '' %>
                <%- end -%>
                <a data-hover-hint="top" class="hint" title="<%= description %>">(?)</a>
              </div>
            <%- end -%>
            <div class="form-field">
              <label for="app_configuration_password">Your node root password:</label>
              <%= password_field_tag "app[password]", '' %>
            </div>
            <button>install</button>
          <%- end -%>
        <%- end -%>
      </div>
      
    </li>
  <%- end -%>
</ul>

<%= render :partial => 'preferences/app_installer/app_sources' %>
<%= render :partial => 'preferences/app_installer/app_bindings' %>
