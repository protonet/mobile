<h2>Advanced</h2>
<p class="info-message"><strong>Caution:</strong> These settings are meant for advanced users only, please be careful.</p>
<h3>Captive Portal <a data-hover-hint="top" title="Users need to authenticate before receiving internet access" class="hint">(?)</a></h3>
<%= form_tag system_preferences_update_path, { :remote => true, 'data-type' => 'html' } do -%>
  <%= hidden_field_tag 'section', 'advanced_settings' %>
  <div class="form-field">
    <label>Status:</label>
    <span>
      <label>
        <input type="radio" name="preferences[captive]" value="true" <%= 'checked' if SystemCaptivePortal.status %>>
        On
      </label>
      <label>
        <input type="radio" name="preferences[captive]" value="false" <%= 'checked' unless SystemCaptivePortal.status %>> 
        Off
      </label>
    </span>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[captive_authorization_url]', 'Captive authorization URL:' %>
    <%= text_field_tag 'preferences[captive_authorization_url]', SystemPreferences.captive_authorization_url %>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[captive_external_interface]', 'External IF:' %>
    <%= text_field_tag 'preferences[captive_external_interface]', SystemPreferences.captive_external_interface %>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[captive_internal_interface]', 'Internal IF:' %>
    <%= text_field_tag 'preferences[captive_internal_interface]', SystemPreferences.captive_internal_interface %>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[captive_redirection_target]', 'Redirection IP:' %>
    <%= text_field_tag 'preferences[captive_redirection_target]', SystemPreferences.captive_redirection_target %>
  </div>
  <%= button "Save" %>
<%- end -%>

<br />

<%= form_tag "/captive/whitelist", { :remote => true, 'data-type' => 'html' } do -%>
  <%= hidden_field_tag 'section', 'advanced_settings' %>
  <div class="form-field">
    <%= label_tag 'whitelist', 'Whitelisted IPs:' %>
    <%= text_area_tag 'whitelist', SystemPreferences.whitelist.join("\n") %>
  </div>
  <%= button "Save" %>
<%- end -%>

<h4>List of users with internet access:</h4>
<%- users = SystemCaptivePortal.list %>
<%- if users.empty? %>
  <p class="hint">No user has currently internet access granted</p>
<%- else -%>
  <p><%= users.join(", ") %></p>
<%- end -%>

<h3>Email Settings <a data-hover-hint="top" title="Allows you to use external SMTP services to send emails" class="hint">(?)</a></h3>
<dl>
  <dt>Currently using:</dt><dd><%= ActionMailer::Base.delivery_method %></dd>
  <% Mailer %>
  <dt>Current base path:</dt><dd><%= "#{SystemPreferences.public_host_https ? 'https' : 'http'}://#{ActionMailer::Base.default_url_options[:host]}" %></dd>
</dl>
<br>
<%= form_tag system_preferences_update_path, {} do -%>
  <%= hidden_field_tag 'section', 'advanced_settings' %>
  <div class="form-field">
    <label>Local email delivery:</label>
    <span>
      <label>
        <input type="radio" name="preferences[local_email_delivery]" value="true" <%= 'checked' if SystemPreferences.local_email_delivery == true %>>
        On
      </label>
      <label>
        <input type="radio" name="preferences[local_email_delivery]" value="false" <%= 'checked' if SystemPreferences.local_email_delivery != true %>> 
        Off
      </label>
      <a title="Turning on local delivery and leaving the SMTP settings empty will make your node use sendmail." data-hover-hint="top" class="hint">(?)</a>
    </span>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[smtp_address]', 'SMTP Address:' %>
    <%= text_field_tag 'preferences[smtp_address]', SystemPreferences.smtp_address %>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[smtp_domain]', 'SMTP Domain:' %>
    <%= text_field_tag 'preferences[smtp_domain]', SystemPreferences.smtp_domain %>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[smtp_username]', 'SMTP Username:' %>
    <%= text_field_tag 'preferences[smtp_username]', SystemPreferences.smtp_username %>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[smtp_password]', 'SMTP Password:' %>
    <%= password_field_tag 'preferences[smtp_password]', SystemPreferences.smtp_password %>
  </div>
  <%= button "Save" %>
<%- end -%>

<h3>LDAP <a data-hover-hint="top" title="Handle your user authorization via remote LDAP" class="hint">(?)</a></h3>
<%= form_tag system_preferences_update_path, { :remote => true, 'data-type' => 'html' } do -%>
  <%= hidden_field_tag 'section', 'advanced_settings' %>
  <div class="form-field">
    <label>Status:</label>
    <span>
      <label>
        <input type="radio" name="preferences[remote_ldap_sign_on]" value="true" <%= 'checked' if SystemPreferences.remote_ldap_sign_on %>>
        On
      </label>
      <label>
        <input type="radio" name="preferences[remote_ldap_sign_on]" value="false" <%= 'checked' unless SystemPreferences.remote_ldap_sign_on %>> 
        Off
      </label>
    </span>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[remote_ldap_host]', 'LDAP Host:' %>
    <%= text_field_tag 'preferences[remote_ldap_host]', SystemPreferences.remote_ldap_host %>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[remote_ldap_base]', 'LDAP Base:' %>
    <%= text_field_tag 'preferences[remote_ldap_base]', SystemPreferences.remote_ldap_base %>
  </div>
  <div class="form-field">
    <%= label_tag 'preferences[remote_ldap_domain]', 'LDAP Domain:' %>
    <%= text_field_tag 'preferences[remote_ldap_domain]', SystemPreferences.remote_ldap_domain %>
  </div>
  <%= button "Save" %>
<%- end -%>

<h3>VPN</h3>
<%- vpn_status = SystemVpn.status %>

<%= form_tag preferences_vpn_update_path, { :remote => true, 'data-type' => 'html' }  do %>
  <%= hidden_field_tag 'section', 'advanced_settings' %>
  <dl>
    <dt>VPN type:</dt><dd>n2n</dd>
    <dt>Supernode address:</dt><dd>directory.protonet.info</dd>
    <dt>Node address:</dt><dd>10.0.0.1</dd>
    <dt>Identifier/Community:</dt><dd><%= SystemPreferences.vpn[:identifier] %></dd>
    <dt>Password/Encryption key:</dt><dd><%= SystemPreferences.vpn[:password] %></dd>
  </dl>
  <br>
  <div class="form-field">
    <label>Status:</label>
    <span>
      <label><input type="radio" name="vpn_status" value="true" <%= "checked" if vpn_status %>> On</label>
      <label><input type="radio" name="vpn_status" value="false" <%= "checked" unless vpn_status %>> Off</label>
    </span>
  </div>
  <%= button "Save" %>
<%- end %>
