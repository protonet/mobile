<h3><%=h channel.name %></h3> <p id="channel-description"><%=h channel.description %></p>
<%= channel_listen_control(channel) %>
<p id="channel-owner">(Owner: <%= channel.owner.display_name %>)</p>
<h4>Channel subscribers:</h4>
<ul id="channel-subscribers">
  <% channel.listens.all(:include => :user).each do |listen| %>
    <% if !listen.user.stranger? && user = listen.user %>
      <li>
    <%= avatar(user, :width => 20, :height => 20) %>
    <span><%= user.display_name %><% if channel.owned_by(listen.user) %> (owner)<% end %></span>
    <% if channel.owned_by(current_user) %>
      <% if !channel.owned_by(listen.user) %>
        <%= link_to('remove listener', listen_path(listen), :method => :delete, :class => "channel-remove-listner") %>
      <% end %>
      <% if !channel.public? && !listen.verified? && !channel.owned_by(listen.user) %>
        (<%= link_to('verify listener', listen_accept_path(listen), :method => :post, :class => "channel-verify-listner") %>)
      <% end %>
    <% end %>
    </li>
    <% end %>
  <% end %>
</ul>
<br>
<% unless permitted_to?(:update, channel) %>
<h4>Channel Options:</h4>
<p>
  <%= channel.public? ? "public (users can subscribe without verification)" : "private (every subscription has to be verified by owner)" %>
</p>
<p>
  <%= channel.global? ? "global (channel is visible from external nodes and clients)" : "local (channel is visible only from directly connected clients)" %>
</p>
<% else %>
  <h4>Edit Channel Options:</h4>
  <div id="edit-<%= channel.id %>" class="edit section">
   <%= form_for channel, :url => { :action => 'update' } do |f| -%>
     <fieldset>
       <%= f.hidden_field :id, { :value => channel.id, :id => "channel-id-#{channel.id}" } %>
       <%= f.label :public, "public (users can subscribe without verification)?" %>
       <%= f.check_box :public %>
     <br/>
       <%= f.label :global, "global (channel is visible from external nodes and clients)" %>
       <%= f.check_box :global %>
     <br/>
       <%= button "Save" %>
     </fieldset>
   <% end %>
   </div>

  <h4>Actions:</h4>
  <span class="destroy">
    <%= link_to('delete channel', channel_path, :method => :delete) %>
  </span>
<% end %>

<h4>The channel this network belongs to:</h4>
<%= link_to(channel.network.name, networks_path) %> (<%= channel.network.description %>)
UUID: <%= channel.uuid %>
