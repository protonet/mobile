<head>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta charset="UTF-8">
  <meta property="og:image" content="/img/apple-touch-icon.png">
  <meta property="og:title" content="<%= SystemPreferences.browser_title %>">
  <link rel="shortcut icon" href="/img/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
  <link rel="fluid-icon" href="/img/apple-touch-icon.png" title="<%= SystemPreferences.browser_title %>">
  <link rel="image_src" href="/img/apple-touch-icon.png" type="image/png">
  <title>
    <%= SystemPreferences.browser_title %>
  </title>
  <script>
    var protonet = protonet || {};
    protonet.config = {
      base_url:                   location.protocol + "//" + location.host,
      node_base_url:              "<%= node_base_url %>",
      xhr_streaming_url:          "<%= xhr_streaming_url %>",
      dispatching_server:         "<%= server_name %>",
      dispatching_server_port:    "<%= configatron.socket.port %>",
      dispatching_websocket_port: "<%= configatron.websocket.port %>",
      force_xhr_streaming:        <%= raw(incoming_interface == "published_to_web" ? "true" : "false") %>,
      token:                      "<%= current_user.communication_token %>",
      default_avatar:             "<%= configatron.default_avatar %>",
      user_name:                  "<%= current_user.display_name %>",
      user_id:                    <%= current_user.id %>,
      user_is_admin:              <%= current_user.admin?.to_json %>,
      user_is_stranger:           <%= current_user.stranger?.to_json %>,
      show_file_widget:           <%= SystemPreferences.show_file_widget.to_json %>,
      show_user_widget:           <%= SystemPreferences.show_user_widget.to_json %>,
      show_search_widget:         <%= SystemPreferences.show_search_widget.to_json %>,
      show_clouds:                <%= SystemPreferences.show_clouds.to_json %>,
      show_user_navigation:       <%= SystemPreferences.show_user_navigation.to_json %>,
      show_only_online_users:     <%= SystemPreferences.show_only_online_users.to_json %>,
      allow_modal_views:          <%= SystemPreferences.allow_modal_views.to_json %>,
      session_id:                 "<%= cookies['_rails_dashboard_session'] %>",
      authenticity_token:         "<%= form_authenticity_token %>",
      available_channels:         <%= raw(get_channel_mapping_as_json) %>,
      server:                     "<%= request.server_software %>",
      debug_mode:                 <%= (configatron.log_event_notifications.nil? ? false : configatron.log_event_notifications).to_json %>
    };
    
    <%= "var AIRBRAKE_API_KEY = '#{HoptoadNotifier.configuration.api_key}';" if Rails.env.production? %>
  </script>
  <%- if custom_stylesheet -%>
    <%- if SystemPreferences.custom_css_type == "append" -%>
      <%= stylesheet_link_tag(stylesheets, :cache => (configatron.avoid_caching != false), :concat => true) %>
      <%= stylesheet_link_tag("/css/pages/#{controller_name}", :cache => (configatron.avoid_caching != false), :concat => false) rescue nil %>
    <%- end -%>
    <%= raw custom_stylesheet %>
  <%- else -%>
    <%= stylesheet_link_tag(stylesheets, :cache => (configatron.avoid_caching != false), :concat => true) %>
    <%= stylesheet_link_tag("/css/pages/#{controller_name}", :cache => (configatron.avoid_caching != false), :concat => false) rescue nil %>
  <%- end -%>
  <%= csrf_meta_tag %>
  <%# Ensure HTML5 support in IE < 9 %>
  <!--[if lt IE 9]>
    <script>
      "abbr article aside audio canvas details figcaption figure footer header hgroup mark meter nav output progress section summary time video".replace(/\w+/g, function(t){ document.createElement(t); });
    </script>
  <![endif]-->
</head>