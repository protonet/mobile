<%= "<ul class=\"user-messages\" id=\"messages-for-channel-#{channel.id}\">" unless @no_wrap %>
  <% reset_wrapper_variables %>
  <%- tweets.each_with_index do |t, i| -%>
    <% show_wrapper_start, show_wrapper_end, last_id = calculate_wrappers(tweets, t, i) %>
    <%= render :partial => '/tweets/tweet', :locals => {:message => t.message, :avatar => t.user.active_avatar_url,
                                                        :author => t.author, :created_at => t.created_at,
                                                        :html_id => "tweet-#{last_id}", :show_wrapper_start => show_wrapper_start, :show_wrapper_end => show_wrapper_end } %>
    <%- if t.text_extension? -%>
    <script type="text/javascript">//<![CDATA[
      protonet.globals.textExtensions.push({
        channel_id: <%= channel.id.to_json %>,
        container_id: <%= "tweet-#{last_id}".to_json %>,
        data: <%= t.text_extension %>
      });
    //]]></script>
    <%- end -%>
  <%- end -%>
<%= "</ul>" unless @no_wrap %>