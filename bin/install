#!/bin/bash

bundle install

pkgs=( wget rabbitmq-server librabbitmq-dev git-core libossp-uuid-dev libmysqlclient-dev graphicsmagick mysql-server sun-java6-jre )
pkgs_to_install=( )

for pkg in "${pkgs[@]}"
do
  dpkg -l | egrep "\s$pkg\s" 2>&1 > /dev/null
  if [[ $? != 0 ]]; then
    sudo apt-get install -y $pkg
  fi
done

echo "Setup database y/N?"
read answer

if [[ $answer == 'y' ]] || [[ $answer == 'Y' ]]; then
  bundle exec rake db:setup
fi

which node 2>&1 > /dev/null
if [[ $? != 0 ]]; then
  cd /tmp
  wget http://nodejs.org/dist/node-v0.2.6.tar.gz
  tar -xzvf node-v0.2.6.tar.gz
  cd node-v0.2.6
  make clean
  ./configure
  make
  sudo make install
fi

mkdir -p public/externals/image_proxy
mkdir -p public/externals/screenshots
git submodule init
git submodule update